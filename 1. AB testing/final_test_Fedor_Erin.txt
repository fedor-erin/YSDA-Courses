
Федор Ерин
-----------------

1. Для оценки АБ тестов используются t-test, критерий Манна-Уитни, бутстреп - какие у них плюсы и минусы?

Ответ:
1) t-test: имеет ряд предположений на сравниваемые выборки (независимость, равенство дисперсий, выборочные средние распределены нормально); есть проблема при неизвестных дисперсиях - t-статистика тогда распределена приближенно; вычислительно легок; на малых выборках может быть неточен; не устойчив к выбросам.
2) Манн-Уитни: ранговый критерий, не опирается на статистики распределения (среднее/дисперсия); есть предположения - выборки из одинакового распределения с точностью до сдвига, независимость наблюдений в выборках и выборок в целом; устойчив к выбросам; вычислительно легок.
3) Бутстреп: вычислительно трудоёмок (требуется с возвращением насэмплить до 10к выборок размера n исходного массива); нет предположений об исходном распределении; можно оценить любую статистику (среднее/перцентиль/дисперсию), как функцию от выборки; имеет три варианта исполнения - нормальный и центральный интервалы, интервал на основе перцентилей.


2. При выборе метрики нужно помнить о каннибализации. Что такое каннибализация? Приведите пример.

Ответ:
Каннибализация - это рост продаж одного товара/услуги за счет падения продаж другого. Например, у нас приложение с доставкой еды из ресторана, мы обновили раздел с пиццей, сделали красивые баннеры, а остальные категории оставили без изменений. Клиенты начали гораздо чаще брать пиццу, а продажи других блюд упали (салаты, паста и т.д.). Если в качестве метрики взять продажи в категории, в которую вносили изменения, то стат. тест покажет эффект, но смысла в этом не будет, потому что эта метрика - прямое следствие изменений, такая метрика не подойдет. Нужна более общая метрика, например, средний чек в целом или объем продаж в день, то есть более косвенный показатель. Тогда мы учтем в метрике и тесте нашу конечную цель - повысить продажи в ресторане, а не конкретно пиццы.


3. От каких параметров зависит MDE при проверке гипотезы о равенстве средних? Как меняется MDE при изменении каждого из параметров?

Ответ:
1) Допустимые уровни ошибок 1 и 2 рода (альфа и бета) - ошибки разнонаправленные, уменьшение одной приводит к росту другой, нельзя одновременно их уменьшить.
2) Дисперсии контрольной и тестовой групп - квадрат минимального эффекта пропорционален квадрату дисперсии, с ростом дисперсии возможность отловить небольшой эффект пропадает.
3) Размеры выборок - квадрат эффекта обратно пропорционален размеру выборок, с ростом размера выборки появляется возможность отловить все более маленький эффект.



4. Когда стратификация позволяет повысить чувствительность теста? Как это можно объяснить?

Ответ:
1) Если мы можем разделить пользователей по некоторому признаку (пол/возраст/страна), и в рамках каждой такой группы (страты) распределение целевой метрики различается, то мы можем применить стратификацию. 
2) При сэмплировании групп для контроля/теста мы будем в равных долях сэмплировать пользователей из каждой страты, чтобы соотношение было, как в генеральной совокупности. Тогда дисперсия стратифицированного семплирования будет меньше, чем дисперсия случайного, т.к. в случайном мы имеем сумму дисперсий внутри страты и между стратами. Снизив дисперсию, мы можем отловить более низкий эффект (по формуле MDE), то есть повысить чувствительность теста.


5. При каких значениях корреляции ковариаты и целевой метрики CUPED позволяет повысить чувствительность теста?

Ответ:
Ковариата должна коррелировать с целевой метрикой, в общем то чем больше, тем лучше, но при этом она должна быть независима с целевой метрикой, то есть эксперимент не должен влиять на выбранную ковариату. Например, ковариатой может быть сама метрика, но ее значения ДО эксперимента, либо аналогично со стратификацией - пол/возраст/страна.


6. Хотим оценить изменение средней выручки с пользователя за неделю. По историческим данным видим, что CUPED позволяет повысить чувствительность теста при использовании в качестве ковариаты значения выручки с пользователей за неделю перед экспериментом. При реализации алгоритма оценки эксперимента была допущена ошибка, в качестве ковариаты использовалась суммарная выручка за неделю до и за неделю во время эксперимента. Как это повлияет на вероятности ошибок I и II рода? Поясните ответ.

Ответ:
Данные до/после смешались, поэтому ковариата уже не такая независимая, она содержит часть данных из эксперимента, из-за этого дисперсия на деле не сильно снизилась, а значит эффект будет менее заметен. Повысится ошибка 2 рода - будем думать, что эффекта нет, а он есть, при этом ошибка 1 рода снизится в силу разнонаправленности ошибок.


7. Хотим сравнивать среднюю продолжительность сессий пользователей на сайте. Почему применить t-test в лоб ко всем длинам сессий или к средним длинам сессий по пользователям может быть не лучшей идеей?

Ответ:
Средняя длина сессии - это Ratio метрика, для которой t-тест не применим и методы повышения чувствительности тоже. Если возьмем средние сессии по пользователям, то теряем часть информации из-за объединения (много/мало сессий у одного юзера, все юзеры с равными весами), а также не сохраним направленность метрики (общая длина сессий может расти, а среднее по юзерам уменьшаться). В обоих случая некорректное p-value получаем.


8. Перечислите корректные способы оценки ratio-метрик, коротко опишите как они работают. Какие у них плюсы и минусы?

Ответ:
1) Бутстреп - генерируем выборки из А/Б, берем разность ratio-метрик для каждой пары групп А/Б, сравниваем распределение дельт с нулем. Вычислительно сложно, нет пользовательской метрики. 
2) Дельта-метод - хотим применить, например, t-тест для метрики отношения (X/Y), вычисляем матожидание (отношение выборочных средних) и дисперсию (разложение в Тейлора в т. матожиданий и подстановка в формулу дисперсии), считаем t-статистику для такой величины и находим p-value. Вычислительно легко, все еще нет пользовательской метрики.
3) Линеаризация - вводим новую пользовательскую метрику как L=X-kY, линеаризованная метрика = avg(L). Коэф-т k можно взять равным k=Ra, Ra - ratio-метрика в А группе. Вычислительно легко, пользовательская метрика здесь сохраняется в отличие от других методов. 
Все три метода дают корректную оценку p-value и сохраняют направленность.


9. Опишите, как можно организовать распределение пользователей по экспериментам и контрольным/экспериментальным группам при множественном тестировании.

Ответ:
Можно использовать хэш от id пользователя и брать остаток по модулю N, где N - кол-во слотов, часть в А группу, часть в Б, например, 50/50. Для корректного последующего теста нужно применять второе хэширование (с солью) внутри слотов, чтобы еще перемешать юзеров и снова поделить на А/Б группы. Если есть ветки изменений, то для них разные ветки, а внутри одной ветки соль одинаковая. Отдельно держим пользователей под самые важные обновления (10%), соль одна во всех экспериментах для них.


10. Для каких экспериментов последовательное тестирование хорошо подходит, а для каких плохо? Приведите примеры и поясните свой выбор.

Ответ:
1) Когда у нас есть доступ к данным в любой момент и мы имеем всегда актуальный срез состояния эксперимента и пользователей, а также критически важно сэкономить на затратах на проведение эксперимента и важно определиться с эффектом, чем раньше, тем лучше, то имеет смысл в последовательном тестировании. Например, новое классное обновление для онлайн-продукта, которое сулит большой рост выручки и хочется выкатить его как можно раньше. То есть здесь промедление - упущенная выгода, а данные у нас всегда есть оперативные. При этом важно помнить про проблему подглядывания, можно смотреть, но не принимать решения, либо определиться, сколько раз подглядываем, чтобы контролировать уровень ошибок 1 рода (будем постепенно увеличивать p-value), который растет при подглядывании.
2) В остальных случаях, когда нет условий для реализации правильного последовательного тестирования или промедление с решением не критично, не стоит делать последовательное тестирование. Например, у нас оффлайн-бизнес и данные приходят с большой задержкой.
